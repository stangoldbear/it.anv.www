# Data Model: MDX Content Architecture

**Feature**: MDX Content Migration for Associazione Nuova Vita Website
**Date**: 2025-10-10
**Phase**: Phase 1 - Design

## Overview

This document defines the data models, schemas, and entity relationships for the MDX-based content architecture. All content is stored as MDX files with YAML frontmatter metadata. No database is used; the file system is the source of truth.

## Entities

### Page Entity

Represents a content page on the website.

**Storage**: MDX file in `/content/pages/`

**Fields**:
| Field | Type | Required | Description | Example |
|-------|------|----------|-------------|---------|
| title | string | Yes | Page title displayed in browser and heading | "Chi Siamo" |
| description | string | Yes | Meta description for SEO (max 160 chars) | "Scopri la storia e i valori di Associazione Nuova Vita" |
| slug | string | Yes | URL path (must start with /) | "/chi-siamo" |
| date | string (ISO 8601) | Yes | Publication date in YYYY-MM-DD format | "2025-10-10" |
| template | string | No | Template component name (defaults to "page") | "landing-page" |
| showInNav | boolean | No | Whether to display in main navigation (defaults to true) | true |
| navOrder | number | No | Sort order in navigation (lower = earlier) | 10 |
| metaImage | string | No | Relative path to social sharing image | "./images/chi-siamo-og.jpg" |

**Validation Rules**:
- `title`: 1-70 characters, cannot be empty
- `description`: 50-160 characters for optimal SEO
- `slug`: Must start with `/`, lowercase, hyphen-separated, no spaces
- `date`: Must be valid ISO 8601 date (YYYY-MM-DD)
- `template`: Must match existing template file name in `src/templates/`
- `navOrder`: Positive integer

**Example MDX File**:
```mdx
---
title: Chi Siamo
description: Scopri la storia, i valori e la missione di Associazione Nuova Vita
slug: /chi-siamo
date: 2025-10-10
template: page
showInNav: true
navOrder: 10
---

# Chi Siamo

Associazione Nuova Vita è un'organizzazione senza scopo di lucro...

## La Nostra Storia

Fondata nel 1995, la nostra associazione...

## I Nostri Valori

<Card>
  <CardTitle>Compassione</CardTitle>
  <CardContent>Mettiamo le persone al centro di tutto ciò che facciamo.</CardContent>
</Card>
```

**TypeScript Interface**:
```typescript
interface PageFrontmatter {
  title: string;
  description: string;
  slug: string;
  date: string; // ISO 8601
  template?: string;
  showInNav?: boolean;
  navOrder?: number;
  metaImage?: string;
}

interface Page {
  id: string; // Generated by Gatsby
  frontmatter: PageFrontmatter;
  body: string; // MDX content
  excerpt: string; // Auto-generated excerpt
  internal: {
    contentFilePath: string;
  };
}
```

### NavigationMenu Entity

Represents the site's main navigation menu.

**Storage**: Derived from Page entities where `showInNav` is true

**Fields**:
| Field | Type | Description |
|-------|------|-------------|
| items | NavigationItem[] | Array of navigation links |

**NavigationItem Fields**:
| Field | Type | Description | Example |
|-------|------|-------------|---------|
| label | string | Display text for link | "Chi Siamo" |
| href | string | URL path | "/chi-siamo" |
| order | number | Sort order | 10 |

**TypeScript Interface**:
```typescript
interface NavigationItem {
  label: string;
  href: string;
  order: number;
}

interface NavigationMenu {
  items: NavigationItem[];
}
```

**GraphQL Query**:
```graphql
query NavigationMenu {
  allMdx(
    filter: { frontmatter: { showInNav: { eq: true } } }
    sort: { frontmatter: { navOrder: ASC } }
  ) {
    nodes {
      frontmatter {
        title
        slug
        navOrder
      }
    }
  }
}
```

**Usage in Header Component**:
```typescript
import { useStaticQuery, graphql, Link } from 'gatsby';

const Header: React.FC = () => {
  const data = useStaticQuery<{
    allMdx: {
      nodes: Array<{
        frontmatter: {
          title: string;
          slug: string;
          navOrder: number;
        };
      }>;
    };
  }>(graphql`
    query NavigationMenu {
      allMdx(
        filter: { frontmatter: { showInNav: { eq: true } } }
        sort: { frontmatter: { navOrder: ASC } }
      ) {
        nodes {
          frontmatter {
            title
            slug
            navOrder
          }
        }
      }
    }
  `);

  return (
    <nav>
      {data.allMdx.nodes.map((node) => (
        <Link key={node.frontmatter.slug} to={node.frontmatter.slug}>
          {node.frontmatter.title}
        </Link>
      ))}
    </nav>
  );
};
```

### Document Entity

Represents downloadable files (PDFs, forms, reports) referenced from the Documenti page.

**Storage**: Static files in `/static/documents/`, referenced in MDX

**Fields**:
| Field | Type | Description | Example |
|-------|------|-------------|---------|
| title | string | Display name of document | "Statuto 2025" |
| description | string | Brief description | "Statuto dell'associazione aggiornato" |
| filename | string | File name with extension | "statuto-2025.pdf" |
| category | string | Document category | "Governance" |
| date | string | Publication date | "2025-01-15" |
| fileSize | string | Human-readable file size | "1.2 MB" |

**TypeScript Interface**:
```typescript
interface Document {
  title: string;
  description: string;
  filename: string;
  category: string;
  date: string;
  fileSize: string;
}
```

**Usage in MDX**:
```mdx
---
title: Documenti
description: Scarica moduli, statuti e report dell'associazione
slug: /documenti
date: 2025-10-10
---

# Documenti

## Governance

<DocumentLink
  title="Statuto 2025"
  description="Statuto dell'associazione aggiornato"
  href="/documents/statuto-2025.pdf"
  fileSize="1.2 MB"
  date="2025-01-15"
/>

<DocumentLink
  title="Bilancio 2024"
  description="Bilancio consuntivo dell'anno 2024"
  href="/documents/bilancio-2024.pdf"
  fileSize="850 KB"
  date="2025-02-01"
/>
```

### CallToAction Entity

Represents prominent action buttons/links on pages.

**Storage**: Component props within MDX files

**Fields**:
| Field | Type | Required | Description | Example |
|-------|------|----------|-------------|---------|
| label | string | Yes | Button text | "Dona Ora" |
| href | string | Yes | Destination URL | "/donate" |
| variant | string | No | Visual style | "primary" / "secondary" / "outline" |
| external | boolean | No | Opens in new tab if true | false |

**TypeScript Interface**:
```typescript
interface CallToAction {
  label: string;
  href: string;
  variant?: 'primary' | 'secondary' | 'outline';
  external?: boolean;
}
```

**Usage in MDX**:
```mdx
---
title: Homepage
slug: /
---

# Benvenuti

<Hero
  title="Aiutiamo la Comunità"
  description="Associazione Nuova Vita supporta le persone in difficoltà"
>
  <Button href="/donate" variant="primary">Dona Ora</Button>
  <Button href="/chi-siamo" variant="secondary">Scopri di Più</Button>
</Hero>
```

## Schema Relationships

```
┌─────────────────────────────────────────────┐
│                   Page                      │
│  - id: string                               │
│  - frontmatter: PageFrontmatter             │
│  - body: string (MDX content)               │
│  - internal.contentFilePath: string         │
└──────────────────┬──────────────────────────┘
                   │
                   │ (filtered by showInNav)
                   │
                   ▼
┌─────────────────────────────────────────────┐
│            NavigationMenu                   │
│  - items: NavigationItem[]                  │
│    └─ label, href, order                    │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│                Document                     │
│  - title: string                            │
│  - filename: string                         │
│  - category: string                         │
│  (Referenced in Documenti page MDX)         │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│             CallToAction                    │
│  - label: string                            │
│  - href: string (links to Page.slug)        │
│  (Embedded as component in MDX)             │
└─────────────────────────────────────────────┘
```

## MDX Frontmatter Schema

### Complete Schema Definition

```yaml
# Complete frontmatter schema for all pages
type: object
required:
  - title
  - description
  - slug
  - date
properties:
  title:
    type: string
    minLength: 1
    maxLength: 70
    description: Page title for browser tab and main heading
  description:
    type: string
    minLength: 50
    maxLength: 160
    description: Meta description for SEO and social sharing
  slug:
    type: string
    pattern: ^/[a-z0-9-/]*$
    description: URL path starting with slash, lowercase with hyphens
  date:
    type: string
    format: date
    pattern: ^\d{4}-\d{2}-\d{2}$
    description: Publication date in ISO 8601 format (YYYY-MM-DD)
  template:
    type: string
    enum: [page, landing-page]
    default: page
    description: Template component to use for rendering
  showInNav:
    type: boolean
    default: true
    description: Whether to include in main navigation menu
  navOrder:
    type: integer
    minimum: 0
    description: Sort order in navigation (lower numbers appear first)
  metaImage:
    type: string
    pattern: ^\.\/images\/.*\.(jpg|jpeg|png|webp)$
    description: Relative path to Open Graph image for social sharing
```

### Page-Specific Schemas

#### Homepage Schema
```yaml
# /content/pages/index.mdx
required: [title, description, slug, date]
properties:
  slug:
    const: /
  navOrder:
    const: 0
```

#### Standard Page Schema
```yaml
# /content/pages/chi-siamo.mdx, /content/pages/servizi.mdx, etc.
required: [title, description, slug, date]
properties:
  template:
    const: page
  showInNav:
    const: true
  navOrder:
    type: integer
    minimum: 1
```

#### Donation Pages Schema
```yaml
# /content/pages/donate.mdx, /content/pages/5x1000.mdx
required: [title, description, slug, date]
properties:
  slug:
    enum: [/donate, /5x1000]
  showInNav:
    const: true
  # Additional data can be embedded as structured content in MDX
```

## Validation

### Build-Time Validation

Frontmatter validation should occur during the Gatsby build process in `gatsby-node.ts`:

```typescript
import { z } from 'zod';

const PageFrontmatterSchema = z.object({
  title: z.string().min(1).max(70),
  description: z.string().min(50).max(160),
  slug: z.string().regex(/^\/[a-z0-9-/]*$/),
  date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/),
  template: z.enum(['page', 'landing-page']).default('page'),
  showInNav: z.boolean().default(true),
  navOrder: z.number().int().nonnegative().optional(),
  metaImage: z.string().regex(/^\.\/images\/.*\.(jpg|jpeg|png|webp)$/).optional(),
});

export const onCreateNode: GatsbyNode['onCreateNode'] = ({ node, reporter }) => {
  if (node.internal.type === 'Mdx') {
    try {
      PageFrontmatterSchema.parse(node.frontmatter);
    } catch (error) {
      reporter.panicOnBuild(
        `Invalid frontmatter in ${node.internal.contentFilePath}: ${error.message}`
      );
    }
  }
};
```

### Runtime Type Safety

All GraphQL queries should use Gatsby's generated types:

```typescript
import type { PageTemplateQuery } from '../../gatsby-types';

const PageTemplate: React.FC<PageProps<PageTemplateQuery>> = ({ data }) => {
  // data.mdx.frontmatter is fully typed
  const { title, description, date } = data.mdx.frontmatter;
};
```

## Content Guidelines

### File Naming Conventions

- MDX files: `kebab-case.mdx` (e.g., `chi-siamo.mdx`, `diventa-socio.mdx`)
- Images: `kebab-case.{jpg,png,webp}` (e.g., `hero-homepage.jpg`)
- Documents: `kebab-case-year.pdf` (e.g., `statuto-2025.pdf`)

### Directory Structure

```
content/
└── pages/
    ├── index.mdx              # Homepage (slug: /)
    ├── chi-siamo.mdx          # About Us (slug: /chi-siamo)
    ├── servizi.mdx            # Services (slug: /servizi)
    ├── donate.mdx             # Donate (slug: /donate)
    ├── 5x1000.mdx             # 5x1000 (slug: /5x1000)
    ├── diventa-socio.mdx      # Membership (slug: /diventa-socio)
    └── documenti.mdx          # Documents (slug: /documenti)

static/
├── images/
│   ├── hero-homepage.jpg
│   └── chi-siamo-team.jpg
└── documents/
    ├── statuto-2025.pdf
    └── bilancio-2024.pdf
```

### Content Authoring Rules

1. **Frontmatter is mandatory**: Every MDX file must have valid frontmatter
2. **Slugs must be unique**: No two pages can have the same slug
3. **Dates must be current**: Use current date for new content
4. **Descriptions must be concise**: 50-160 characters for SEO
5. **Navigation order must be explicit**: Assign navOrder to control menu order
6. **Images must have alt text**: All images must include descriptive alt attributes
7. **Links must be relative**: Use relative paths for internal links (e.g., `/chi-siamo`)
8. **Components must be from design system**: Only use approved components (Button, Hero, Card)

## Migration Mapping

Existing TSX pages → New MDX files:

| Current File | New File | Slug | Nav Order |
|--------------|----------|------|-----------|
| src/pages/index.tsx | content/pages/index.mdx | / | 0 |
| src/pages/chi-siamo.tsx | content/pages/chi-siamo.mdx | /chi-siamo | 10 |
| src/pages/servizi.tsx | content/pages/servizi.mdx | /servizi | 20 |
| src/pages/donate.tsx | content/pages/donate.mdx | /donate | 30 |
| src/pages/5x1000.tsx | content/pages/5x1000.mdx | /5x1000 | 40 |
| src/pages/diventa-socio.tsx | content/pages/diventa-socio.mdx | /diventa-socio | 50 |
| src/pages/documenti.tsx | content/pages/documenti.mdx | /documenti | 60 |
| src/pages/404.tsx | src/pages/404.tsx (unchanged) | /404 | N/A |

## References

- YAML Schema Specification: https://yaml.org/spec/
- ISO 8601 Date Format: https://en.wikipedia.org/wiki/ISO_8601
- Zod Validation Library: https://zod.dev/
- Gatsby Node API: https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node/
